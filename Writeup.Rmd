---
title: "Closing the Gender Gap in Urban Cycling"
subtitle: "A look at gendered patternsin NYC’s Citi Bike System"
author: "Ian Dinsmore, Fiachra McDonagh, Lexi Nieves, Em Webster"
date: "05/19/2018"
output:
  html_document: default
  pdf_document:
    number_sections: yes
urlcolor: blue
---
#####<span style="color:red">DISCLAIMER</span>
We don’t know how the gender data in the database used for this post was collected, so it’s unclear if our data reflects identified gender or gender assigned at birth, hence why don’t make the distinction in this presentation. We acknowledge the problematic nature of drawing conlculsions from data that whose collection methods we don't have a full understanding of, as well as the problematic nature of a coding gender as a binary variable as that excludes people who idenitfy outside the gender binary. However, we must work with the data we have avaliable, and urge data scientests in the future to be more transparent about their data collection methods and make space for gender diversity within their data.

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(error = TRUE)
```

```{r include=FALSE, cache=FALSE}
library(dbplyr)
library(mdsr)
library(RMySQL)
library(readr)
library(ggthemes)
library(waffle)
library(extrafont)
```

```{r include=FALSE, cache=FALSE}
db <- dbConnect_scidb("citibike")
```

```{r include=FALSE, cache=FALSE}
query <- "
SELECT 
user_type,
gender
FROM trips AS t
WHERE gender = 1 OR gender = 2
LIMIT 0,100
"
query <- db %>% dbGetQuery(query) %>% collect()
genderpct <- as.data.frame(query)
```

```{r include=FALSE, cache=FALSE}
genderpct$gender <- as.factor(genderpct$gender)
var <- genderpct$gender
nrows <- 10
df <- expand.grid(y = 1:nrows, x = 1:nrows)
categ_table <- round(table(var) * ((nrows*nrows)/(length(var))))
categ_table
```

```{r include=FALSE, cache=FALSE}
loadfonts()
fonts()[grep("Awesome", fonts())]
```

```{r include=FALSE, cache=FALSE}
fonts()[grep("Awesome", fonts())]
```

## Introduction
  As urban biking as a mode of transportation has increased in popularity over the years, a significant gender gap has been emerging, with [just one is four bikers identifying as female](https://nhts.ornl.gov/2009/pub/stt.pdf). This pattern can clearly be seen in New York City’s Citi Bike program, as well as many other urban bike sharing programs across America. This is a serious issue, as transportation is one of the biggest household expenses in America and [women are more likely to be economically disadvantaged than men](https://www.americanprogress.org/issues/women/reports/2008/10/08/5103/the-straight-facts-on-women-in-poverty/). Cycling could provide a greatly needed route for women to cut transportation costs, but for some reason women are tending to stay away from the bike lanes. Why is this? With the extensive data collected by NYC’s Citi Bike system, we can hope to gain insight into the gendered trends in urban cycling and to use those insights to propose solutions to the gender gap in biking.
  
## What is overall gender distribution of Citi Bike Users?
```{r, echo = FALSE}
library(waffle)
parts <- c(`Male (73%)`=73, `Female (27%)`=27)
chart <- waffle(parts, rows=5, use_glyph = "bicycle", glyph_size = 6,colors = c("dodgerblue", "deeppink"),
       title="Citi Bike Users by Gender") + theme_fivethirtyeight() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),axis.text = element_blank(),
        axis.ticks.x = element_blank())+ labs(subtitle="1 square = 425 Riders")
chart
```

This graph depicts the distribution of Citi Bike trips by gender. As one can clearly see, the Citi Bike program is dominated by male riders, accounting for almost three fourths of the trips taken. 

## Does the gender distribution differ by duration of trip?
```{r include=FALSE, cache=FALSE}
query <- "SELECT start_time, stop_time, gender FROM trips LIMIT 0,300"

trip_times <- db %>% dbGetQuery(query) %>% collect()
trip_times
```

```{r include=FALSE, cache=FALSE}
trip_times <- trip_times %>% filter(gender != 2) %>% mutate(trip_length = difftime(stop_time, start_time, units = "mins"), row_num = row_number()) 
trip_times <- trip_times %>% mutate(gender = as.character(gender))
trip_times
```

```{r, echo = FALSE, warning=FALSE}
trips_plot <- trip_times %>% ggplot(aes(x = gender, y = trip_length, fill = gender )) + geom_boxplot() + ylab("Trip Duration in Minutes") + xlab(" ") + ylim(c(0,65)) + scale_fill_manual(name="Gender",
                         breaks=c("0", "1"),
                         labels=c("Male", "Female"),
                         values = c("dodgerblue", "deeppink")) + theme_fivethirtyeight() +theme(axis.title=element_text(size=12)) + ggtitle("Trip Duration by Gender")

trips_plot
```

This graph depicts the distribution of trip duration by gender. Men seem to have a slightly higher trip duration median than women, but the difference does not appear to be signifgant, thus providing little inisight into the causes or effects of the gender gap in the Citi Bike program.

## Methodology
The data we used for this project were drawn from multiple sources. The average in-state tuition and at four-year public institutions in 1969 through 2011 came from the [National Center for Education Statistics](https://nces.ed.gov/programs/digest/d12/tables/dt12_381.asp). Data on federal minimum wages from 1939 to present came from the [Department of Labor](https://www.dol.gov/whd/minwage/chart.htm). Berkley specific data came from [here](http://admissions.berkeley.edu/cost-of-attendance), Charlottesvilles specific data came from here, and Ann Arbor specific data came from [here](http://www.umich.edu/~bhlumrec/um-fees/1976_fees.pdf) and [here](http://ro.umich.edu/tuition/tuition-fees.php).

We mapped dollars as a function of time to create space to examine, compare, and contrast our three variables as they all operate within these frames. Values were also adjusted for inflation to allow for ample comparison.
We used two graph types throughout our post: the line chart and the bar graph.

We used a line chart to illustrate our data because it accentuates trends by following a variable over time. Furthermore, a line chart helps the reader see how these trends move or don't move together and switch their order.  The information that our graph seeks to convey comes from over time, therefore we decided to use a line graph to connect our cases.The average cost of tuition against summer wages and the average rate of growth of college tuition are time based. Our decision to use line charts was also influenced by our use of averages. Because we are working with averages, we did not need to use a scatter plot examine the trend over individual cases of college tuition prices and wages to highlight the trend.

In all of our graphics wanted to choose color schemes that emphasised contrast among all the variables being measured. In our first graphic, however, we took extra precaution to ensure clarity. We came to a consensus to use bars to illustrate summer wages to keep from using too many lines and easily convey information. This also helps us focus how we aim to position the all of the trends relative to one another and gives a visual sense of what the stagnation phenomena looks like. For our second graphic, We used a stacked bar graph to create two comparisons, one comparing the cost of tuition among three individual cases (not averages) at two specific points in time. We wanted to create bold contrast between 1976 and 2014, which is why we used grey and red for the bar fill.In our third graphic, we only compared two trends, which makes it important to use  contrasting colors for clarity and a theme that did not add to line confusion. In each graphic, we selected our theme based on its ability to help focus on the data and not distract. 